"0",""
"0","con <- odbcConnect(dsn = ""DA"","
"0","                   uid = key_get(""db_user""),"
"0","                   pwd = key_get(""db_pass""))"
"0",""
"0","ld_df_raw <- sqlQuery(con,"""
"0","                      SELECT *"
"0","                      FROM ref_db.ray.ld_players_data "
"0","                        "")"
"0","  "
"0",""
"0",""
"0",""
"0","ld_df <- ld_df_raw "
"0",""
"0",""
"0","## Data Cleaning"
"0","ld_df[ld_df$`Turnover Usd` == 0 & ld_df$`Ggr Usd` == 0 |"
"0","        ld_df$`Bet Count` == 0,] <- NA"
"0",""
"0","ld_cleaned <- ld_df |>"
"0","  drop_na()"
"0",""
"0","ld_cleaned <- ld_cleaned |>"
"0","  group_by(Playerid,`Game Type`,`Vendor Name`) |>"
"0","  arrange(`Activity Month`) |>"
"0","  mutate(LT_Active_Days = cumsum(`Active Days Per Month`),"
"0","         LT_Bet_Count = cumsum(`Bet Count`),"
"0","         LT_Turnover_USD = cumsum(`Turnover Usd`),"
"0","         LT_GGR_USD = cumsum(`Ggr Usd`))"
"2","Warning in for (k in seq_along(quosures)) { :"
"2","
 "
"2"," closing unused RODBC handle 29
"
"0","scoring <- function(x) {"
"0","  res <- as.integer()"
"0","  for(i in 1:length(x)) {"
"0","    if(x[i] >= 3.5) {"
"0","     res[i] <- 4"
"0","    } "
"0","    else if (x[i] >= 0 & x[i] < 3.5){"
"0","      res[i] <- 3"
"0","    }"
"0","    else if (x[i] > -3.5 & x[i] < 0){"
"0","      res[i] <- 2"
"0","    }"
"0","    else if (x[i] <= -3.5) {"
"0","      res[i] <- 1"
"0","    }"
"0","    else{res[i] <- 0}"
"0","    "
"0","  }"
"0","  res"
"0","  "
"0","}"
"0",""
"0","r.zscore <- function(x) coalesce((x-median(x,na.rm=T))/mad(x,na.rm = T),0)"
"0",""
"0",""
"0","segments <- function(x) {"
"0","  res <- c()"
"0",""
"0","  for(i in 1:length(x)) {"
"0","    if (x[i] == 444) {"
"0","      res[i] <- ""Profitable Outlier"""
"0","    }"
"0","    else if (x[i] >= 311 & x[i] < 444 ) {"
"0","      res[i] <- ""Profitable"""
"0","    }"
"0","    else if (x[i] > 144 & x[i] < 311 | x[i] < 144) {"
"0","      res[i] <- ""Grinder"""
"0","    }"
"0","    else if (x[i] == 144) {"
"0","      res[i] <- ""Grinder Outlier"""
"0","    } else {NULL}"
"0","    "
"0","  }"
"0","  res"
"0","  "
"0",""
"0","}"
"0",""
"0",""
